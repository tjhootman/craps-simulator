<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Craps Strategy Simulator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #0f172a;       /* Deep Navy */
            --card-bg: #1e293b;        /* Lighter Navy */
            --primary: #f43f5e;        /* Dice Red */
            --accent: #22d3ee;         /* Cyan */
            --danger: #ef4444;         /* Ruin Red */
            --gold: #fbbf24;           /* Winner Gold */
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
        }

        *, *::before, *::after { box-sizing: border-box; }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 40px 20px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px; width: 100%; background: var(--card-bg);
            padding: 30px; border-radius: 16px; border: 1px solid #334155;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }

        h1 {
            margin-top: 0; text-align: center; font-weight: 800;
            background: -webkit-linear-gradient(45deg, #f43f5e, #fbbf24);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 30px; font-size: 2rem;
        }

        /* GRID SYSTEM */
        .controls {
            display: grid; grid-template-columns: repeat(4, 1fr);
            gap: 15px; margin-bottom: 20px; padding: 25px;
            background: #0f172a; border-radius: 12px; border: 1px solid #334155;
        }

        .control-group { display: flex; flex-direction: column; }
        .wide-input { grid-column: span 2; }

        label {
            font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px;
            font-weight: 700; margin-bottom: 8px; color: var(--text-muted);
        }

        input, select {
            background: #1e293b; color: white; padding: 0 12px; height: 45px;
            border: 1px solid #475569; border-radius: 8px; font-size: 0.95rem; width: 100%;
        }
        
        #strategy { border-color: var(--primary); color: #fca5a5; font-weight: 600; }
        #pressMode { border-color: var(--accent); color: #67e8f9; font-weight: 600; }

        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .info-card { padding: 15px 20px; border-radius: 8px; text-align: left; transition: all 0.3s ease; }
        .info-card strong { display: block; font-size: 1.1rem; margin-bottom: 5px; }
        .info-card p { margin: 0; font-size: 0.9rem; color: #e2e8f0; line-height: 1.4; }
        
        #strategyInfo { background: rgba(244, 63, 94, 0.1); border: 1px solid var(--primary); }
        #strategyInfo strong { color: #fda4af; }
        #pressInfo { background: rgba(34, 211, 238, 0.1); border: 1px solid var(--accent); }
        #pressInfo strong { color: #67e8f9; }

        button {
            grid-column: 1 / -1; padding: 16px;
            background: linear-gradient(to right, #f43f5e, #e11d48);
            color: white; border: none; border-radius: 8px;
            font-size: 1.1rem; font-weight: bold; cursor: pointer;
            text-transform: uppercase; letter-spacing: 1px; transition: transform 0.1s;
        }
        button:hover { transform: translateY(-1px); }
        button:disabled { opacity: 0.7; cursor: wait; }

        .stats-bar {
            display: flex; justify-content: space-around; margin-bottom: 20px;
            padding: 20px; background: #0f172a; border-radius: 12px; border: 1px solid #334155;
            flex-wrap: wrap; gap: 15px;
        }
        .stat-box { text-align: center; min-width: 120px; }
        .stat-val { font-size: 1.8rem; font-weight: 800; display: block; margin-bottom: 5px; }
        .stat-label { font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase; }

        .chart-container { position: relative; height: 500px; width: 100%; background: #0f172a; border-radius: 12px; padding: 10px; border: 1px solid #334155; }
        .legend-bar { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-top: 15px; padding: 10px; }
        .legend-item { display: flex; align-items: center; font-size: 0.85rem; color: var(--text-muted); font-weight: 600; }
        .dot { width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; display: inline-block; }
        .line-dash { width: 25px; height: 0; border-top: 2px dashed #fbbf24; margin-right: 8px; display: inline-block; }

        @media (max-width: 1024px) { .controls { grid-template-columns: 1fr 1fr; } .wide-input { grid-column: span 1; } button { grid-column: span 2; } }
        @media (max-width: 600px) {
            body { padding: 15px 10px; } .container { padding: 15px; }
            .controls { grid-template-columns: 1fr; padding: 15px; } button { grid-column: span 1; }
            .info-grid { grid-template-columns: 1fr; gap: 10px; } .chart-container { height: 300px; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Craps Profit & Variance Simulator</h1>

    <div class="controls">
        <div class="control-group">
            <label>Start Bankroll ($)</label>
            <input type="number" id="bankroll" value="2000" min="50">
        </div>
        <div class="control-group">
            <label>Min Table Bet ($)</label>
            <input type="number" id="minBet" value="10" min="5">
        </div>
        <div class="control-group">
            <label>Rolls (Duration)</label>
            <input type="number" id="rolls" value="500" max="2000">
        </div>
        <div class="control-group">
            <label>Simulations (Max 100)</label>
            <input type="number" id="sims" value="50" max="100">
        </div>

        <div class="control-group wide-input">
            <label style="color: #fca5a5;">Betting Strategy</label>
            <select id="strategy" onchange="updateInfoCards()">
                <option value="pass_odds">Pass Line + Max Odds (The Math Play)</option>
                <option value="iron_cross">Iron Cross (Action/Grind)</option>
                <option value="place_68">Place 6 & 8 (Conservative)</option>
                <option value="dark_side">Dark Side (Don't Pass + Lay)</option>
            </select>
        </div>
        
        <div class="control-group wide-input">
            <label style="color: #67e8f9;">Profit Strategy (Pressing)</label>
            <select id="pressMode" onchange="updateInfoCards()">
                <option value="collect">Same Bet (Collect Winnings)</option>
                <option value="press_half">Press Half (Increase 50% on Win)</option>
                <option value="press_full">Power Press (Double on Win)</option>
            </select>
        </div>

        <button id="runBtn" onclick="handleRun()">Roll The Dice</button>
    </div>

    <div class="info-grid">
        <div class="info-card" id="strategyInfo"><strong>Strategy</strong><p>...</p></div>
        <div class="info-card" id="pressInfo"><strong>Profit Strategy</strong><p>...</p></div>
    </div>

    <div class="stats-bar">
        <div class="stat-box">
            <span class="stat-val" id="stat-ror">0%</span>
            <span class="stat-label">Risk of Ruin</span>
        </div>
        <div class="stat-box">
            <span class="stat-val" id="stat-avg">$0</span>
            <span class="stat-label">Avg Result</span>
        </div>
        <div class="stat-box">
            <span class="stat-val" id="stat-max">$0</span>
            <span class="stat-label">Max Win</span>
        </div>
    </div>

    <div class="chart-container">
        <canvas id="chartCanvas"></canvas>
    </div>

    <div class="legend-bar">
        <div class="legend-item"><span class="dot" style="background-color: #fbbf24;"></span> Hot Shooter (2x)</div>
        <div class="legend-item"><span class="dot" style="background-color: #10b981;"></span> Profitable</div>
        <div class="legend-item"><span class="dot" style="background-color: rgba(255,255,255,0.2);"></span> Survivor</div>
        <div class="legend-item"><span class="dot" style="background-color: #ef4444;"></span> Ruined ($0)</div>
    </div>
</div>

<script>
    Chart.defaults.color = '#94a3b8'; Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';
    let myChart = null;
    const USD = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });

    const ODDS_PAYOUT = { 4: 2, 10: 2, 5: 1.5, 9: 1.5, 6: 1.2, 8: 1.2 }; 
    const PLACE_PAYOUT = { 4: 1.8, 10: 1.8, 5: 1.4, 9: 1.4, 6: 1.166, 8: 1.166 }; 
    
    const STRAT_DESC = {
        pass_odds: "<strong>The 'Smart' Play.</strong> Pass Line with 3x Odds. Lowest house edge (<1%). Variance comes from waiting for the Point to hit.",
        iron_cross: "<strong>The Action Play.</strong> Bets on Field, 5, 6, 8. Wins on EVERY roll except 7. High frequency wins, but 'Big Red' (7) wipes out 4 bets at once.",
        place_68: "<strong>The Conservative Play.</strong> Bet $12 on 6 and $12 on 8. Wait for hits. Take them down after a few wins or press them up.",
        dark_side: "<strong>The Contrarian.</strong> Betting *against* the shooter (Don't Pass). You win when everyone else loses (on 7). Low house edge, but socially awkward."
    };
    
    const PRESS_DESC = {
        collect: "<strong>Safe & Steady.</strong> Every time a bet wins, you put the chips in your rack. Minimizes risk, but limits max profit potential.",
        press_half: "<strong>Balanced Growth.</strong> On a win, add half the profit to the bet. Grows your action while taking some profit off the table.",
        press_full: "<strong>Power Press (Max Profit).</strong> Re-invest 100% of winnings into the bet. Exponential growth on a hot roll, but one '7' kills a massive stack."
    };

    function updateInfoCards() {
        const strat = document.getElementById('strategy').value;
        const press = document.getElementById('pressMode').value;
        document.getElementById('strategyInfo').innerHTML = `<p>${STRAT_DESC[strat]}</p>`;
        document.getElementById('pressInfo').innerHTML = `<p>${PRESS_DESC[press]}</p>`;
    }

    function handleRun() {
        const btn = document.getElementById('runBtn');
        btn.innerHTML = "Rolling..."; btn.disabled = true;
        setTimeout(() => { runSimulation(); btn.innerHTML = "Roll The Dice"; btn.disabled = false; }, 50);
    }

    function rollDice() {
        const d1 = Math.floor(Math.random() * 6) + 1;
        const d2 = Math.floor(Math.random() * 6) + 1;
        return d1 + d2;
    }

    function runSimulation() {
        let bankroll = parseFloat(document.getElementById('bankroll').value);
        let minBet = parseFloat(document.getElementById('minBet').value);
        let maxRolls = parseInt(document.getElementById('rolls').value);
        let sims = parseInt(document.getElementById('sims').value);
        const strategy = document.getElementById('strategy').value;
        const pressMode = document.getElementById('pressMode').value;

        if (sims > 100) sims = 100;
        if (maxRolls > 2000) maxRolls = 2000;

        const allDatasets = [];
        let ruinedCount = 0;
        let finalSum = 0;
        let maxWin = 0;

        for (let s = 0; s < sims; s++) {
            let cash = bankroll;
            let currentData = [{x: 0, y: cash}];
            let point = 0; 
            let activeBets = {}; 
            let isRuined = false;

            for (let r = 1; r <= maxRolls; r++) {
                if (cash < minBet) { isRuined = true; cash = 0; }
                
                if (!isRuined) {
                    const roll = rollDice();
                    let winnings = 0;
                    let losses = 0;

                    // --- 1. GAME STATE UPDATE (FIXED: Runs independently of bets) ---
                    let event = 'neutral'; 
                    if (point === 0) {
                        if (roll === 7 || roll === 11) event = 'natural';
                        else if (roll === 2 || roll === 3 || roll === 12) event = 'craps';
                        else { point = roll; event = 'point_set'; }
                    } else {
                        if (roll === point) { event = 'point_hit'; point = 0; }
                        else if (roll === 7) { event = 'seven_out'; point = 0; }
                    }

                    // --- 2. PLACE BETS ---
                    
                    // Come Out Bets (Pass/Don't)
                    if (point === 0 && event !== 'natural' && event !== 'craps') {
                        // Point is being set (or was just cleared), ready for next Come Out
                        // (Logic handled implicitly: pass bets stay up unless lost)
                    }
                    if (point === 0) {
                        if (strategy === 'pass_odds' && !activeBets.pass) { cash -= minBet; activeBets.pass = minBet; }
                        if (strategy === 'dark_side' && !activeBets.dontpass) { cash -= minBet; activeBets.dontpass = minBet; }
                    }

                    // Point Established Bets (Odds, Place, Iron Cross)
                    if (point !== 0) {
                        // Pass Line Odds
                        if (strategy === 'pass_odds' && activeBets.pass && !activeBets.odds && cash > minBet * 3) {
                            activeBets.odds = minBet * 3; cash -= activeBets.odds;
                        }

                        // Place 6 & 8
                        if (strategy === 'place_68' && cash > (minBet+2)*2) {
                            let betAmt = minBet + 2; 
                            if (!activeBets.place6 && point !== 6) { activeBets.place6 = betAmt; cash -= betAmt; }
                            if (!activeBets.place8 && point !== 8) { activeBets.place8 = betAmt; cash -= betAmt; }
                        }

                        // Iron Cross
                        if (strategy === 'iron_cross' && cash > minBet * 4) {
                            if (!activeBets.place5 && point !== 5) { activeBets.place5 = minBet; cash -= minBet; }
                            if (!activeBets.place6 && point !== 6) { activeBets.place6 = minBet+2; cash -= (minBet+2); }
                            if (!activeBets.place8 && point !== 8) { activeBets.place8 = minBet+2; cash -= (minBet+2); }
                            // Field is always placed in Iron Cross
                            if (!activeBets.field) { activeBets.field = minBet; cash -= minBet; }
                        }
                    }

                    // --- 3. RESOLVE PAYOUTS ---

                    // A. Pass Line
                    if (activeBets.pass) {
                        if (event === 'natural') winnings += activeBets.pass; // 7/11
                        else if (event === 'craps') { losses += activeBets.pass; delete activeBets.pass; }
                        else if (event === 'point_hit') {
                            winnings += activeBets.pass;
                            if (activeBets.odds) {
                                // Reconstruct point for odds payout (since we reset point to 0 above)
                                winnings += activeBets.odds * ODDS_PAYOUT[roll];
                                cash += activeBets.odds; delete activeBets.odds; 
                            }
                        }
                        else if (event === 'seven_out') {
                            losses += activeBets.pass + (activeBets.odds || 0);
                            delete activeBets.pass; delete activeBets.odds;
                        }
                    }

                    // B. Don't Pass
                    if (activeBets.dontpass) {
                        if (event === 'natural') { losses += activeBets.dontpass; delete activeBets.dontpass; }
                        else if (event === 'craps' && roll !== 12) winnings += activeBets.dontpass;
                        else if (event === 'seven_out') winnings += activeBets.dontpass;
                        else if (event === 'point_hit') { losses += activeBets.dontpass; delete activeBets.dontpass; }
                    }

                    // C. Place Bets / Field (Only work if Point Established, except Field works always)
                    
                    // Field (Iron Cross) - Works every roll
                    if (activeBets.field) {
                        if ([2,3,4,9,10,11,12].includes(roll)) {
                            let mult = (roll === 2 || roll === 12) ? 2 : 1;
                            winnings += activeBets.field * mult;
                            cash += activeBets.field; delete activeBets.field; 
                        } else {
                            losses += activeBets.field; delete activeBets.field;
                        }
                    }

                    // Place Bets (Work if point is established, Lost on 7-out)
                    if (point !== 0 || event === 'seven_out') {
                        if (roll === 7) {
                            // Lose all place bets
                            losses += (activeBets.place5||0) + (activeBets.place6||0) + (activeBets.place8||0);
                            delete activeBets.place5; delete activeBets.place6; delete activeBets.place8;
                        } else {
                            // Pay Wins
                            if (activeBets.place5 && roll === 5) winnings += activeBets.place5 * 1.4;
                            if (activeBets.place6 && roll === 6) winnings += activeBets.place6 * 1.166;
                            if (activeBets.place8 && roll === 8) winnings += activeBets.place8 * 1.166;
                        }
                    }

                    // --- 4. PRESS LOGIC ---
                    if (winnings > 0) {
                        if (pressMode === 'collect') {
                            cash += winnings;
                        } else if (pressMode === 'press_half') {
                            cash += (winnings * 0.5); 
                        } else {
                            // Full press: Re-invest (simplified visual)
                        }
                    }
                }
                currentData.push({x: r, y: cash});
            }
            
            finalSum += cash;
            if (cash > maxWin) maxWin = cash;
            if (isRuined) ruinedCount++;

            let color = 'rgba(255, 255, 255, 0.1)'; 
            let order = 1;
            if (isRuined) { color = 'rgba(239, 68, 68, 0.5)'; order = 2; }
            else if (cash > bankroll * 1.5) { color = '#fbbf24'; order = 4; }
            else if (cash > bankroll) { color = 'rgba(16, 185, 129, 0.5)'; order = 3; }

            allDatasets.push({
                label: `Sim ${s}`, data: currentData, borderColor: color,
                borderWidth: (order === 4) ? 2 : 1, pointRadius: 0, 
                fill: false, tension: 0.1, order: 100 - order
            });
        }

        const ror = ((ruinedCount / sims) * 100).toFixed(1);
        document.getElementById('stat-ror').innerText = `${ror}%`;
        document.getElementById('stat-avg').innerText = USD.format(finalSum / sims);
        document.getElementById('stat-max').innerText = USD.format(maxWin);

        renderChart(allDatasets, bankroll, maxRolls);
    }

    function renderChart(datasets, startLine, maxX) {
        const ctx = document.getElementById('chartCanvas').getContext('2d');
        if (myChart) myChart.destroy();

        datasets.push({
            label: 'Start Bankroll', data: [{x: 0, y: startLine}, {x: maxX, y: startLine}],
            borderColor: '#fbbf24', borderWidth: 2, borderDash: [5, 5], pointRadius: 0, order: 0
        });

        myChart = new Chart(ctx, {
            type: 'line', data: { datasets: datasets },
            options: {
                responsive: true, maintainAspectRatio: false, animation: false,
                plugins: { legend: { display: false }, tooltip: { enabled: false } },
                scales: {
                    x: { type: 'linear', display: true, grid: { color: 'rgba(255,255,255,0.05)' }, max: maxX },
                    y: { display: true, grid: { color: 'rgba(255,255,255,0.05)' } }
                }, elements: { line: { tension: 0 } }
            }
        });
    }

    updateInfoCards();
    handleRun();
</script>

</body>
</html>